## 2.12 v05+
探究发现，循环脚本反复执行会拖慢服务器。将循环脚本修改为每次执行完毕后将状态传出，启动新的脚本并结束当前脚本，可以有效地规避FPS突然下降的情形。
仅针对RES巡逻组探究（关闭所有playable的AI队伍），发现RES数量并不会导致FPS下降，非循环的脚本使得FPS稳定在59（仍然存在突变至35的情形，但它仍然还会返回59，在两个FPS之间的变化更像是跃迁）。
+ Res巡逻组
	+ DynamicInitializationGroup启动Start目录的巡逻组脚本。
	  Start目录放置初始化脚本，启动Loop目录的循环脚本。
	  循环脚本设置：
		+ 恢复原本的巡逻组模式。
		  采用loadFile命令获得初始坐标和巡逻坐标。巡逻坐标的SQF仍然设置112次上限以及沿用旧坐标的设定。
		  进入Destroy阶段后，如果因为距离过远而进入反抢判定，不再设置如果没有敌城镇则回到巡逻模式。
		  TakeTown及Destroy阶段都不使用forEach执行，而是用goto的方式设置循环，并使用2秒的延时稀释。
			+ 从测试来看，之前的FPS下降有可能是taketown阶段没有使用延时导致的。
				+ 某次测试，早期（怀疑20min，但无法证实）FPS下降到35，40min时回升到59，55min时跌落35并持续到95min，然后回升到59，一直持续（本次实验destroy阶段因为bug而不会移动）。
				  假说：patrol与destroy阶段无lag，taketown阶段有，从而少量组的patrol时间比较短，destroy阶段比较长（40min），因而造成了第一次FPS跌落。
				  第二次跌落则源于部分组具有较长的patrol时间（55）和destroy时间（95）。
		+ 创造Common\DelayMove脚本，用于延迟移动。
		  这个脚本用于Destroy阶段让RES单位在发炮后才开始移动。
		  
对于其他循环脚本，也有必要做此类调整，但很遗憾的是仅就Server FPS而言***并不能完全解决问题***。DOOM强度的RES以及双方4支AI队伍的测试，大概可以维持70min的高FPS，之后落到35-40，当AI队伍数量继续增加后，FPS在开局20分钟左右就会跌落到35-40的区间，相比之前似乎有所提升，但显然问题没有被彻底解决。
另外需要指出的是，为节省局部变量的资源，有必要将延时扔到脚本的最开头。
+ AI单位命令脚本
  与其设置命令脚本的更迭，倒不如设置AI队长在新启动循环时直接增加id，进而更迭AI的命令脚本。
  ***放弃具体的脚本命令循环模式。已使用队长脚本循环机制。***
	+ 首先要指出的是，所有命令脚本最开头的**busy循环**都要增加idOrder的出口，并且将2s的延时增加到5s。
	+ 脚本的路径定义于orderDefs矩阵。已经调整了这个矩阵只存储脚本的名字，不存储上一级的路径，因此可以利用它来启动loop目录下的同名文件。
	  在命令脚本的初始化阶段，读取_order指针时，就一并将script名称读取。
		+ ***Temporary脚本也需要这么处理。***
	+ 只修改常用的2个Guard、2个Patrol、HoldTown，以及AI常用的TakeHoldTown。
		+ ***TakeHoldTown似乎无法脱出Hold片段。已检查两种模式所有出口的逻辑值赋值，待观测。***
		+ 单位执行holdTown命令的效率太低。会不会和载具、300m判定等有关？
+ AI队长命令脚本
	+ 每3分钟传出状态。
	+ ***事实上AI购买检测可以重新扔出去。***
+ AICO命令脚本
	+ 每3分钟传出状态。
	  AICO有非常多的状态参数，数组规模31，有可能还有遗漏，需要观察。
+ KnowsAbout脚本
	+ 根据res阵营与否启动不同的循环脚本。
	+ **player目录下的脚本也做成循环。**
+ Town Group脚本
	+ 玩家双方的TG脚本，只修改1和3号。
	+ Res的TG脚本，只修改1号。
+ 工厂制造脚本
	+ 正常。AICO会购买步兵和维修卡车。
+ 工人、support脚本
+ Server功能脚本
	+ UpdateServer, UpdateIncome
Player目录下的循环脚本也有必要做出调整。事实上，时有玩家的游戏程序崩溃退出的情形发生，有理由相信一些脚本的持续循环与此有关。此外，civ的镜头在游戏开始一定时间之后就会有明显的滞涩感，这很可能也是出于相同的缘由。
+ Player功能脚本
	+ UpdatePlayer(Spectator)，UpdatePlayerVehicle。
	+ 玩家的3个Marker脚本，CIV的Marker脚本（做成自循环的模式）。
		+ 设置Marker以及Spectator的模式后，镜头移动以及地图拖动平滑得超出想象。
		+ 刷新频率要增加，大概30s左右安排一次重置。

玩家数较多时Server FPS下降是事实。在调整循环脚本的现在，还需要进一步观察，但估且先引入KnowsAbout分布式计算，各client只处理自己的local队伍。
+ ***队长和建筑缺乏client的启动途径。***
+ ***需要观察新模式的联机FPS与玩家数的关联***。

busy、temporary的字符串，将_unit更改为_this。注释skill的实现方式，仍然改为原有的数组模式，但使用set的方式进行写入。如果有问题再恢复为暴力减法。
+ 维修正常。

显示玩家名称时，队伍名通过括号添加在末尾，图标颜色变为橙色。
在**InitGUIControlIDs**补全CIV界面关于NVG和QUIT按钮的IDC。
重新投入T80_TZK模型的使用。
## 2.12 v05
尝试将RES巡逻单位打散到6倍的组里，每个组容纳1坦克。
+ **FPS没有明显变化，卡死现象仍然存在。**
+ **值得一提的是，巡逻组初始自带1坦克，但开始的前10min，FPS仍然是58、59.**
+ 有理由相信组的数量并不很影响FPS。那么**城镇里空载具是否影响性能？**
	
尝试取消巡逻组、取消TG在触发时往巡逻组添加单位。FPS长期稳定59。
保留巡逻组，不开启AI，FPS仍然走低，于30min左右开始。
保留巡逻组，不开启AI，RES的TG不启动循环，FPS仍然走低。
由此猜测和巡逻组脚本的循环次数有关。考虑将状态传出给新脚本，停止当前脚本，成功在无AI队伍时达成长期高FPS。
+ **但是这与只有2组巡逻组时FPS不下降有矛盾。**
尝试将AI队伍命令由逐个单位挂载脚本，改为整支队伍挂载一个脚本。
+ **失败**。即使同期削减res巡逻队伍数量为4，仍然在25min时卡死。更糟的是FPS一度走低到18，这是此前没有过的现象。

## 2.12 v04+
	+ v04通过18vs18 AI 纯步兵测试。但仍然2人挂服。
	+ v03 出现了高频爆发的问题。最值得怀疑的是getUnitTypeFromObject函数的更改。
		+ 但v02一样有问题。
	+ 第一盘1h不挂，第二盘挂，会是什么缘故呢？是否为稳定的情况？
	
	+ ww4动作关闭后，FPS提升到稳定40，但43分钟后仍然卡死。
		+ 关闭动作+res巡逻组，FPS提升到50-，目前25min。
		+ 38min时FPS为44左右。但是CIV拖屏有点卡（dedicated server，civ不是server）。有可能是quit后飞天的缘故，待观测。
		+ 见记事本03.19晚19：45记录。触发所有城镇（2城镇守备坦克），FPS下降到40。不过也只是暂时的事情。很快恢复到45左右。
		
		
		+ 测试带动作无res坦克无时限、带动作无res坦克SQF。追加增广炸药判定。
			+ 以关键字搜索被替换后的getUnitType.sqf片段。
			+ 【注意】，原本res巡逻脚本在摇坐标时，found没有被正确的使用。不过这个是v03的更新内容，而v02就有卡死（应该说卡死一直存在，没有消停过）。
			+ 67min双方交战时FPS下降到35左右。也一度回升到40后又降低到33。与res无关。战场上存在数台固定翼及防空。
			+ 93min已经没有res，FPS还是35左右。
				+ 部分地图，有-500城市，最后也会出现挂服等现象。res脚本问题这么大的吗？
				+ 有的时候对方玩家离线后出现卡死。小概率他们太差，残留res，或者-500。否则大概还是别的地方存在问题。
					+ 说到底，其实没有对res巡逻脚本做调整，为什么问题会在这里呢？还是说其他地方的负担导致res巡逻脚本的【故有问题】凸显？
		+ 测试带动作、无res坦克、少SQF、带增广炸药
			+ 游戏开始的前15分钟，无res巡逻队，AI步兵开始制造但不是很多时，FPS稳定在58、59。AI队伍开始抢城后，FPS由51骤降到34，然后稳定为40，可以认为是统一下达任务导致的。
				+ 从时间来看，之前卡死的时间最早也是20min左右。有可能是AI命令变更，与res巡逻脚本一起导致的过重负担。
			+ 30min时又一度回升到50整。
			+ 90min时同样稳定到35左右。
			
			+ 【用C130空投手枪弹夹炸药去爆破敌方基地试试】
				+ 成功后要把Equip脚本里缺失的主武器弹夹2枚补上。
				+ 之前调整的东西也酌情改回去。需要等待1星期的测试。
	
	+ 核心问题为优化RES模式：
		+ 出生：没必要每次都判断最小规模。一个城镇触发时上一个锁，直接遍历当前的巡逻组规模，然后筹划生成方案，一键制造，10秒或更长时间后解锁。
		+ 巡逻队伍脚本。SQS语法+0.1秒延时反而会造成服务器卡死，因此仍然采用SQF。
			+ 由于大量基础函数改为字符串，因此如果出问题不要忽视这里的影响。
			+ 感觉来说FPS下降与反抢、拆家有关。巡逻坐标与卡死有关。另外随着控城数量的增加，摇坐标也变得困难。
			+ 反抢阶段代码优化
			+ 拆家阶段代码优化
				+ 定义ResDestroyStruct数组与mutexResDestStruct锁
				+ BuildStruct及ReplacePrimStruct进行type判断，为structsDestroy则写入数组，替换objNull
				+ 为RES阵营设置SQF脚本用于返回最近的敌建筑。
		+ 动作+增广炸药+res，18对18，成功运行7h（4h就结束了）
			+ 仍然有失败的情况。因此直接取消patrol的roll，改为直接用初始roll到的坐标每次随机以100米的步长迭代生成，且不校验新坐标是否合理。
				+ 在25min左右卡死。因此应该可以排除patrol pos的影响（除非非法坐标会导致问题）
					+ 测试一下纯粹patrol的结果。
						+ 单次测试成功。抵达50min的彼岸。FPS为35左右。
			+ 取消逐单位检测最近城镇、建筑的判定。直接用巡逻坐标搜索最近的敌城镇、建筑，在搜索成功的情况下，更新巡逻坐标。
				+ 一个问题是队伍全灭后新生单位的坐标变更。
					+ 抢城阶段，当脱离patrol模式后，以巡逻坐标搜索最近的敌城镇，之后始终将坐标设置为第一个unit的坐标，而非捆绑城镇/建筑。
				+ FPS下降到30这样。新生一个城镇的res时，FPS会下降到28。
					+ RES清扫完毕后，FPS回归到35。
					+ 成功。那么Server的那个数组可以弃用了。
				+ 7人联机+中途2人上服，卡死。
				
	+ SQS中遍历时延时0.1或较短的时间，要更改成延时2秒。根据RES巡逻队伍延时0.1导致服务器卡死的情况来看，延时0.1反而可能导致问题。
		
	+ Init.sqs里grpSetting以及Order等字段扔到某个脚本
	+ 测试setObjectTexture对视距外的效果
	+ AI单位远距离移动，对AICO有效。考虑使用向量内积，判定在锐角上最近的town，作为目的地。总是按town移动，对AICO有效，强化城镇的防御。
	+ AI步兵放置炸药的判定，寻距离最近的敌建筑，也不必用sqf，由于预设了knowsAbout机制，那么只需要在已暴露的敌建筑里做距离判定即可。暴露建筑可以由server进行判定。
		+ 对AI坦克开炮也是同理。RES亦然，进入反抢和基地搜寻阶段，负担较重，有可能是对“最近敌建筑”搜寻有较大负担。
	+ 服务器FPS在1人、大量步兵时较低。坦克时不低。问题是什么呢？果然是拓展炸药包么？
	+ 调整摄像头dialog。
	+ KnowsAbout脚本对步兵、建筑有效，而vehicle没有挂载。会不会是它的缘故呢？研究整个KA系统。
		+ KA脚本优化。
	
## 2.12 v04
+ TZK Setting面板
	+ 某个选项变动之后，除bool矩阵要写入新的数值之外，脚本内的"_last"数组也要更新数据。否则只能响应单向的变化。
	+ Player\Info\GroupIsAI设置接收到AI信息后，直接将队长图标改名为队伍名称。
+ CIV
	+ **InitSpectator.sqs**里增设逻辑值bFreeMode用于切换模式。
	+ **Dialog Spectator.sqs**的Quit部分，更改cameraEffect的同时追加camCommit 0，并设置0.1的延时。
		+ （一度测试发现重新指派camSetTarget到_tracker是有效的，无需camCommit，但之后发现失败。）
		+ （这种设置也会失败。）
		+ Quit按钮暂时隐藏。【测试中】。
			+ _cam camCommand "manual off"关闭相机，关闭成功，但无法操纵player。
			+ player cameraEffect["terminate","back"]可以切换视角到player。
				+ 但是对于SpecCam切换再切回，上述组合指令失效。
				+ 不可以使用manual on开启相机。
				+ 追加_cam CameraEffect无效。大概需要指派target吧。
					+ 上述无效设置，quit后0-0-0返回，然后esc，视角会在天上。这个目标是个线索。
			+ 右上角group信息里，选中底端的east group无效，会选到res的组。是否group ID存在问题？还是面板的问题？
			+ 还是右上角group，选中队长时并不总能成功切换tracking单位。有时有报错，有时点击队长并不切换单位到该队长，需要滚动一下屏幕。
	+ **UpdateSpectator.sqs**
		+ 设置一个"_posFreeMove"变量用于记录自由移动模式的坐标，初始化为spectator的起始位置，离开FreeMode时记录，下次进入时移回来。
		+ 主循环里设置一个判定，位于gameOver及alive之后，用于跳出主循环，停止坐标重置。
		+ FreeMode模式下要强制弹出进入载具的CIV。
		+ FreeMode模式设置循环，持续移除武器。退出后重新添加。
		+ 【是否有可能做成自由移动camera模式（含camera背景）】。
		+ 将spectator移动到"_posFreeMove"时，要将camSpec一并移过去。之后点击地图时不再需要调整camSpec，因此理由大概是在dialog、镜头、目标切换时，要等它们处理完毕才行。
	+ （其他镜头优化留待后续版本处理。）
		+ 注意FreeCam模式下，有时按G没有指南针，要等一小段时间才有，表现像是卡死的模样。这估计是个突破口。
+ 为使LF生产的固定翼不被建筑卡住，LF的sdDist数值设为35，和机场一致。
+ Call
	+ call grpSetting经常有错误信息提示。可能是SQF内启动时有问题。对SQF里的call grpSetting进行移除。
	+ 基于Scheduler的角度，将部分轻量级func函数由预编译SQF改为直接定义字符串，在SQS里通过call调用。
		+ 事实上颇有一些SQF的风格很像字符串，考虑到OFP并非一开始就引入SQF语法，一些function很有可能在早期开发CTI时以字符串形式调用，之后改成了SQF，然后SQF就一直被沿用。
		+ 考虑将轻量级SQF改为字符串。
			+ Vector函数的dot内积缺乏对3维向量的支持，一并补上。
			+ UpdateAttaching改写为字符串可能有危险。
			+ AddToUnitMatrix.sqf本质只是索引搜索，可以取消
			+ AddToStructMatrix.sqf只是单纯的写入，也可以取消。事实上还做了进一步的调整，见下。
				+ 顺带一提，一些函数调用矩阵structMatrix时并没有清理objNull，而是直接用等号赋值。
				+ HandleStructMatrixRemove执行了清理objNull的操作。在新的设计下它是不需要的。
			+ Server的MoveAI
			+ Server的Money，只是简单的运算，并没有特地调用sqf的意义，既然已经应用了SQS作为控制开关，那么继续沿用就是了（为了利用互斥保护数组）。
				+ InitUnitFactory在算钱时使用了互斥的前半部分，因此要改写为一个完整的互斥环节。
			+ Server的GetIdleFactory弃用，改为GetIdleFactories，后者改为字符串。
	+ 原有的一些字符串常数，此前没有意识到可以传参，本次它们也一并编辑，并收录于InitFunction脚本里。
+ 建筑系统
	+ 为了优化自动购买系统，首先需要对建筑系统进行调整。
	+ 大原则：出于兼容性考虑，虽然建筑单位多数 setDamage 0 不会像载具发生二次爆炸，但仍然坚持使用新单位替换原有单位。
	+ StructMatrix
		+ 受限于“替换”这一机制，需要设计合理的方法。原有建筑是必须要删除的，即使设置一定的延时，考虑到“延迟”的存在，这个机制仍然不稳定，不可以在远端使用find。
		+ 鉴于建造统一在server上完成，那么广播时设置server将矩阵中的索引一并传出。
		+ StructMatrix需要保证顺序。如果不在某个时刻对矩阵清理索引较小的objNull元素，数组规模将会无上限。
		+ 数量有限制的建筑目前不需要担心，那么需要对工事类建筑进行处理。利用之前定义的structsShelter来区别对待。
		+ AddToStructMatrix
			+ Server上只在BuildStruct、StructuresServerRemove里执行添加。改动后的机制需要一并获取索引并由发讯脚本传出。
			+ 由于BuildStruct是SQF，故需要在Server上设置一个脚本，添加到矩阵后直接传出索引用于发讯。
			+ ReplacePrimStruct里，删除原有建筑的机制，应当将删除单位的时间拖后，利用DeleteVehicleAfterDelay来处理。
				+ 将StructuresServerRemove的启动扔到最后，使用原有object获取索引，写入新的建筑（此处上锁），将索引和新建筑一并传入发讯脚本。
				+ StructuresServerRemove去除矩阵写入，将原有建筑扔到海外，并设置10秒延时后删除。
			+ SendStructBuilt在si的更高一位记录index。如果传入的是-1，则读取当前的数组规模。
			+ structsShelter类型单位，使用find objNull从起始位置替换删除单位。
		+ SendStructMatrixRemove.sqs
			+ 建筑制造统一由server完成，事实上只有server需要获取索引，player是被动接收索引。由于直接采用set执行写入，而删除则由delete的全局性完成，事实上不需要remove。
			+ 因此隐藏server的发讯入口，注释**SendStructMatrixRemove.sqs**的启动。因为矩阵里建筑的索引由server统一计算并发讯，client不可以再自行调整。
	+ Server上的structuresServer数组
		+ 这个数组用于记录建筑数组，在建筑损毁/拆除时将其他组件一并清理。
		+ 为应用find，改写为structServer和structsServer两个数组。前者用于存放0号组件，后者存放其他组件以及"_type"信息。
		+ 几个相关脚本的设置更改。原先整合到一个脚本的做法是不妥的。
	+ Server上的repairableStructureMatrix矩阵
		+ 用于存放待维修的建筑。因为数组格式的缘故，依赖于SQF函数执行维修。如果能够改写为SQS语法并应用互斥锁，将会比较方便。
			+ 多个单位维修完毕后都会启动ReplacedPrimStruct脚本。由于待维修的建筑已经被新的建筑在structServer中替换，但又没有立刻删除（走延时删除模式），会触发报错信息。
		+ 适应于find而拆分为0号组件+其他信息。增设repairableStructureInfo矩阵。
			+ 需要指出的是，为保证顺序，新损毁的建筑总是从末位插入，或替换末尾的objNull。因此在添加元素时，需要特殊处理。
			+ 设置一个从后向前搜索Null元素的函数。放弃原有的sqf。
		+ 将RepairStructure.sqf更改为SQS语法，由worker和support执行。mutexRepairStructure锁从ReplacePrimStruct移动到worker和support脚本里。
			+ 当维修完毕后，由worker和support在脚本的上锁片段将repairableSturcture的相应单位**set**为objNull，而非被动等待它被删除。
		+ 适应于数组元素格式的修改，其它调用脚本的语法做相应调整。
+ AI自动购买
	+ 这个脚本的设计原本就不够完善。增加了factory二值化解码后可能进一步加重负担。
	+ 从已有玩家的风格来看，倾向于大量使用AI自动购买，对真人玩家数不高的情形，AI相应地变多，负担加重。玩家下线后也进入这种情形，而且和笔者测试训练任务，纯爆坦克无压力的情形也不矛盾。
	+ 新的StructMatrix模式，工厂和矩阵中索引总是捆绑的。因此只需从matrix里用+号提取数组，清理null元素后对固定索引判断即可。
	+ UpdateLeader里每个队长每5秒启动一次SQS。这个设置在server的FPS较低时很危险。因此将整个脚本改为UpdateLeader的一个片段。
		+ 主循环的延时仍然为5秒。
		+ 跳转自动购买后执行判断。对于选取了购买方案的队伍，设置它总是从structMatrix里顺位与setting相一致的工厂购买。在工厂损毁时，不从递补的下一个工厂购买，维修完毕后恢复购买。
			+ 但是当工厂被拆除，或不修复而消失，则递补下一个工厂。
		+ 按原方案购买的模式，随机数要-0.5，否则可能选取到count附近，对应元素为nil，造成AddToUnitQueue报错。
			+ setect对非整数的处理，0.5以外的遵循四舍五入，但0.5总是选取到相邻的偶数而非奇数。
			+ Random命令取值范围是0~x，包含0但不包含x。减去0.5后，可以确保不选取到count。
	+ AICO设置在dev模式及getworld == "eden"时购买步兵，用于调试server的FPS。
		+ 单人纯步兵18对18通过，但2人对战有问题，坦克仍然需要怀疑。
		+ InitUnitTypes里将特殊T80取消。不过也不应该，毕竟18对18的步兵也存在res特殊坦克，而setObjectTexture的效果是local的。【仍然卡死】
+ AI命令机制
	+ 将17组满员AI从pickup wait 99min改为don't use后，可以观察到server的FPS从38骤降到25。相关的操作是短时间内大量的busyClear，对全局数组变量执行清理和重新赋值操作。
	+ 因此考虑修改机制。
		+ 延时【暂时】不考虑，尝试使用find和set，在指定位置写入objNull起到擦除效果，写入时使用find objNull来写入或末位添加。【仍然卡死】
		+ in判定的两端【拟考虑】使用互斥锁保护，避免数组编辑过程中的in判定。
		+ 【效果不好】，v04仍然存在挂服现象。
	+ 另一种可用的机制是利用skill值。CTI里默认单位的skill为1，那么可以用0.9998和0.9999来标识它。【仍然卡死】
		+ 设置了superAI的服务器是无法用skill的返回值的。任务里加一个提示。CTI里单位的skill总是1，没必要开superAI。
			+ 【任务提示】尚未添加。
			+ 需要检测setSkill命令的变量与效果分别是全局的还是局部的。
				+ 对效果全局的情形，需要分析一下它的带宽负担。
				+ 需要考虑join的影响。
				+ 【建服后用remote端观察】
			+ 更改busy等的模式。注释原有设置，应用新设计。
		+ 它们和FPS应该没什么关系。
	+ 此外，还有一种可行的做法，即设置throw和put的同类武器。不过它会在rearm执行时被覆盖，用于busy尚可，用于temporary就很不合适了。
	+ AI事件触发器涉及的补给单位记录数组CheckSupportUnits，也采用find和set的方式进行编辑。【仍然卡死】
	+ 一度在队伍order变更时导致服务器卡死。因此在所有orderMatrix, orderTempMatrix出现的脚本里，利用指针优化脚本的写法。【仍然卡死】
		+ 命令脚本创造指针变量指向orderMatrix select _si select _gi。
		+ Handle脚本不可以直接对gi执行set，要对gi的元素逐个写入。这样的设置和自制的MsgSetWPCO响应路点位置变化是一致的。
		+ AI队长的脚本特别处理。虽说此前一直也没有这么优化过，它应该不至于是问题的来源就是了。
		+ 同理处理aiSetting矩阵。
	+ 关闭AI步兵hit的事件触发器。【仍然卡死】
+ AI炸药设置
	+ Order等脚本不再使用sqf获取弹夹数组，使用普通的magazine命令。【仍然卡死】
	+ AI_CheckDropBomb.sqs里，利用sqf读取实际的弹夹，若为零，再调用magazines命令，如果发现漏网之鱼，则执行remove命令。【仍然卡死】
	+ Order命令对于执行炸药（及补给）的单位，sleep的延时上调到至少20秒。【仍然卡死】
	+ 在AI的武装脚本里删除, magPistolSatchel弹夹。【仍然卡死】
	+ 增广炸药地雷在Server目录下恢复原有的判定方式，不采用in判定而是用等号。
	【仍然卡死】。发生时间似乎集中于某个时间点。是res行动机制，还是AICO统一下达命令变更？
		固定翼udFactoryType的改写也是时间触发的条件，但应该与此无关。v02任务已追加机炮固定翼，但其坦克任务没有这种问题。
+ RES、TG延时
	+ 设置res的三个阶段的判定检测、TG脚本的补给检测，遍历时增加0.1s的延时。
+ Overlap函数
	没必要写这个函数，只要用"_x in A" count B > 0判定就可以了。
## 2.12 v03
+ v02仍然卡死（有5人的例子）
+ 服务器减负
	+ Find命令。如果在sqf脚本里使用find，那么并没有实质上将服务器从sqf里解放出来。因此搜索使用find的sqf脚本。
		 + AddRearmData, EditRearmData的sqf脚本被删除，相关机制改写使得无需sqf。
		 + GetRearmData、GetUnitTypeFromObject因为被广泛使用，且被其它sqf调用，因此不删除它们，仅仅将它们与Server的sqf及少量sqs脱钩。GetUnitTypeFromObject只被Server的Order, OrderTemp (SQS)脚本使用。
		 + GetUnitTypeFromObject.sqf里，复制数组但不关联地址，只需使用"+"号。
	+ RES巡逻脚本
		+ **UpdateResPatrolGroup.sqs**脚本全面弃用SQF运算，以SQS的形式进行判定。
		+ PatrolPos的选取也是用SQS格式获取，每次判定延时0.1秒。
	+ **UpdateServer.sqs**里注释CheckDetachedVehicles的运行，无线电频道里已经有召回MHQ的选项。
+ AddWorker判定MHQ是否被拖曳，拖曳的MHQ从tug的位置生成工人。
+ **InitUnitTypes.sqs**中修改榴弹炮在购买列表里的名称（Limited）。修改Ka50的贴图，从插件而非player目录调用（之前没删干净）。
+ 修复Mortar的Equip脚本中残留"xj301"的bug。
+ 炮击功能
	+ 动态生成20个用于炮击的图标。**InitPlayer.sqs**里使用camCreate创造10个不可视H。暂不考虑于服务器的不可视H。
	+ 为玩家队伍命令增设炮击坐标设置/清除命令，以及Mortar/M46建筑、坦克/榴弹炮/Art坦克的炮击命令。对Mortar步兵，由于OFP中fire命令对步兵无效，暂时不设置。
	+ 顺带修改玩家的Order脚本，将其放入Player目录下的Order子目录
+ ShowPad和ShowGPS添加到Spectator的刷新脚本。
## 2.12 v02
+ Equip
	+ 优化EditRearmData系列功能。
	+ 设置4xAA科技在升级时直接对已有单位进行弹夹编辑。
		+ 将相关脚本放到Common\ReEquip目录下
		+ 另外修复UpgState脚本的bug。在UpgState信息脚本里，理应用当前的传入的数值来判断情况，而非直接从矩阵读取数值，原有bug设计会导致Mag科技升级后，新的科技升级使已有的4xAA弹夹翻倍。
	+ 4xAA不适合用游戏原版机炮，它不发射导弹。更改弹药参数之前，取消机炮的设置。4xAA直接继承步兵AA，其cost值为2W，而机炮的cost只是30而已。
+ Temporary系统
	+ 增设All命令
		+ 修改Dialog脚本
		+ 修改Send/Msg脚本，GroupsNum要×2
		+ 设置ALL对Order锁定的队伍不下达临时性命令。
	+ 坦克切换sabot和heat的临时性命令
		+ 设计命令脚本。只由AI队伍的载具gunner启动，并排除remote载具。
		+ 在Common\ReEquip目录下增设实际的重装填弹夹的脚本，供命令脚本调用。
	+ 顺带将临时性命令，以及Order命令的脚本都扔到Server的子目录下
	+ 修复相当一部分临时性命令脚本中indexType不一致的bug（会导致部分命令根本没有用）。
+ 更换榴弹炮为限制角度的Lim版。
+ 设置死亡爆炸效果的5个收讯脚本，用于常规单位。对于res单位，使用logic来实现效果。
+ 为规避笔记本的异常，TZK_Setting里增设ShowPad的逻辑项。
+ 修复v00中dev模式下敌方图标的bug。dev模式强制显示敌图标，而普通模式会隐藏范围外的图标，导致闪烁。因此敌图标的2个脚本在dev模式下要退出。
## 2.12 v01
+ EventHandler
	+ 修复IncomingMissile的bug。这个EH的特殊性在于，如果希望它响应来自remote端的导弹，remote端必须存在一个挂载于相同载具的EH，即使其command参数为空字符串。
	+ 调整Spoof系列的脚本，修复原有bug，并设置drop效果不会在dedicated server上执行。仍然使用publicExec广播。
+ 修复关于"GetUnitMarker.sqf"中对" REMOTE"字符串忽略考虑的bug。
+ 为4xAA添加机炮，测试效果。
+ 引入油桶编辑后的T80模型。
+ 增加死亡坦克燃烧效果。
+ 增加usmc_gala的新任务。
## 2.12 v00
+ 调整版本号。使用"v00-v99"。
+ 解耦图标刷新模式
	+ 己方单位及载具的图标仍然采用sqf，频率2Hz。
	+ 敌方单位采用SQS，频率≤1Hz，首先计算雷达分布，然后显示飞行单位图标；之后进行间谍卫星判定，然后显示图标。
	+ 建筑则每30秒刷新一次，刷新时不对position进行调整，仅判定isNull与否。对己方建筑，额外有一个alive判定与颜色调整。
	+ 调整主循环的显示机制，对于隐藏图标的其个性，减少隐藏的计算判定。
+ 调整UC的模式，为加强对于高速运动的单位的选取，使用UC点击地图时，将Marker名称一并获取，进而判断图标位置是否与点击坐标接近。 